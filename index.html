<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Video Proxy</title>
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; }
        iframe { width: 100vw; height: 100vh; border: none; }
    </style>
</head>
<body>

<script>

    const urlParams = new URLSearchParams(window.location.search);
    const videoId = urlParams.get("v");

    if (!videoId) {
        document.body.innerHTML = "<h3 style='font-family:sans-serif;'>Video bulunamadı.</h3>";
    } else {
        const playerDiv = document.createElement('div');
        playerDiv.id = 'player';
        document.body.appendChild(playerDiv);

        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        document.body.appendChild(tag);

        let player;
        window.onYouTubeIframeAPIReady = function() {
            player = new YT.Player('player', {
                height: '100%',
                width: '100%',
                videoId: videoId,
                playerVars: {
                    'autoplay': 0,
                    'controls': 1,
                    'rel': 1 // önerilen videoları göster
                },
                events: {
                    'onStateChange': onPlayerStateChange
                }
            });

            // Tüm tıklamaları yakala ve yeni sekme açılmasını engelle
            // ve player'da video değiştir
            setTimeout(() => {
                const iframe = document.querySelector('iframe');
                if (iframe) {
                    iframe.contentWindow.document.addEventListener('click', function(e) {
                        let el = e.target;
                        while (el && el.tagName !== 'A') el = el.parentElement;
                        if (el && el.href && el.href.includes('youtube.com/watch')) {
                            e.preventDefault();
                            const url = new URL(el.href);
                            const newId = url.searchParams.get('v');
                            if (newId) {
                                player.loadVideoById(newId);
                            }
                        }
                    }, true);
                }
            }, 2000); // iframe yüklenmesi için bekle
        };

        let lastVideoId = videoId;
        function onPlayerStateChange(event) {
            try {
                const currentUrl = player.getVideoUrl();
                const match = currentUrl.match(/[?&]v=([^&]+)/);
                if (match && match[1] && match[1] !== lastVideoId) {
                    lastVideoId = match[1];
                    window.parent.postMessage({ type: 'videoChanged', videoId: lastVideoId }, '*');
                }
            } catch (e) {}
        }
    }

</script>

</body>
</html>
