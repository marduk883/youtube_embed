<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Video Proxy</title>
    <style>
        body, html { margin: 0; padding: 0; overflow: hidden; }
        iframe { width: 100vw; height: 100vh; border: none; }
    </style>
</head>
<body>

<script>

    const urlParams = new URLSearchParams(window.location.search);
    const videoId = urlParams.get("v");

    if (!videoId) {
        document.body.innerHTML = "<h3 style='font-family:sans-serif;'>Video bulunamadı.</h3>";
    } else {
        const playerDiv = document.createElement('div');
        playerDiv.id = 'player';
        document.body.appendChild(playerDiv);

        const tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        document.body.appendChild(tag);

        let player;
        window.onYouTubeIframeAPIReady = function() {
            player = new YT.Player('player', {
                height: '100%',
                width: '100%',
                videoId: videoId,
                playerVars: {
                    'autoplay': 0,
                    'controls': 1,
                    'rel': 1 // önerilen videoları göster
                },
                events: {
                    'onStateChange': onPlayerStateChange
                }
            });
        };

        let lastVideoId = videoId;
        function onPlayerStateChange(event) {
            try {
                const currentUrl = player.getVideoUrl();
                const match = currentUrl.match(/[?&]v=([^&]+)/);
                if (match && match[1] && match[1] !== lastVideoId) {
                    lastVideoId = match[1];
                    window.parent.postMessage({ type: 'videoChanged', videoId: lastVideoId }, '*');
                }
            } catch (e) {}
        }
    }

</script>

</body>
</html>
